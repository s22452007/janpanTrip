{% extends 'base.html' %}

{% block title %}{{ attraction.name }} - æ™¯é»è©³æƒ…{% endblock %}

{% block content %}
<div class="detail-container">
    <!-- è¿”å›æŒ‰éˆ• -->
    <div class="detail-header">
        <a href="javascript:history.back()" class="back-btn">â† è¿”å›æ™¯é»åˆ—è¡¨</a>
        <div class="action-buttons">
            <button class="favorite-btn" onclick="toggleFavorite({{ attraction.id }})">
                <span class="heart-icon">â™¡</span>
            </button>
            <button class="share-btn" onclick="shareAttraction()">
                <span class="share-icon">âŒ—</span>
            </button>
        </div>
    </div>

    <!-- æ™¯é»åœ–ç‰‡è¼ªæ’­ -->
    <div class="image-gallery">
        <div class="main-image">
            {% if attraction.image %}
                <img src="{{ attraction.image.url }}" alt="{{ attraction.name }}" id="mainImage">
            {% else %}
                {% if attraction.attraction_type.name == 'å¯ºå»Ÿç¥ç¤¾' %}
                    <img src="https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=800&h=400&fit=crop" alt="{{ attraction.name }}" id="mainImage">
                {% elif attraction.attraction_type.name == 'ç¾ä»£æ™¯é»' %}
                    <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=800&h=400&fit=crop" alt="{{ attraction.name }}" id="mainImage">
                {% elif attraction.attraction_type.name == 'è‡ªç„¶é¢¨å…‰' %}
                    <img src="https://images.unsplash.com/photo-1522383225653-ed111181a951?w=800&h=400&fit=crop" alt="{{ attraction.name }}" id="mainImage">
                {% elif attraction.attraction_type.name == 'ç¾é£Ÿ' %}
                    <img src="https://images.unsplash.com/photo-1551218808-94e220e084d2?w=800&h=400&fit=crop" alt="{{ attraction.name }}" id="mainImage">
                {% else %}
                    <img src="https://images.unsplash.com/photo-1480796927426-f609979314bd?w=800&h=400&fit=crop" alt="{{ attraction.name }}" id="mainImage">
                {% endif %}
            {% endif %}
            
            
        </div>
    </div>

    <!-- æ™¯é»åŸºæœ¬è³‡è¨Š -->
    <div class="attraction-header">
        <h1 class="attraction-title">{{ attraction.name }}</h1>
        <div class="attraction-badges">
            <span class="badge primary">{{ attraction.attraction_type.name }}</span>
            <span class="badge secondary">{{ attraction.region.name }}</span>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
    <div class="content-grid">
        <!-- å·¦å´ï¼šæ™¯é»è³‡è¨Š -->
        <div class="info-section">
            <!-- æ™¯é»ä»‹ç´¹ -->
            <div class="info-card">
                <h3 class="section-title">æ™¯é»ä»‹ç´¹</h3>
                <div class="section-content">
                    <p>{{ attraction.description|default:"é€™å€‹ç¾éº—çš„æ™¯é»ç­‰å¾…æ‚¨çš„æ¢ç´¢..." }}</p>
                </div>
            </div>

            <!-- æ™¯é»ç‰¹è‰² -->
            {% if attraction.features %}
            <div class="info-card">
                <h3 class="section-title">æ™¯é»ç‰¹è‰²</h3>
                <div class="features-list">
                    <div class="feature-item">
                        <span class="feature-icon">â—</span>
                        <span class="feature-text">{{ attraction.features }}</span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- è¯çµ¡è³‡è¨Š -->
            <div class="info-card">
                <h3 class="section-title">è¯çµ¡è³‡è¨Š</h3>
                <div class="contact-info">
                    {% if attraction.opening_hours %}
                    <div class="contact-item">
                        <div class="contact-icon">ğŸ•’</div>
                        <div class="contact-details">
                            <div class="contact-label">ç‡Ÿæ¥­æ™‚é–“</div>
                            <div class="contact-value">{{ attraction.opening_hours }}</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if attraction.phone %}
                    <div class="contact-item">
                        <div class="contact-icon">ğŸ“</div>
                        <div class="contact-details">
                            <div class="contact-label">é›»è©±</div>
                            <div class="contact-value">
                                <a href="tel:{{ attraction.phone }}">{{ attraction.phone }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if attraction.website %}
                    <div class="contact-item">
                        <div class="contact-icon">ğŸŒ</div>
                        <div class="contact-details">
                            <div class="contact-label">å®˜æ–¹ç¶²ç«™</div>
                            <div class="contact-value">
                                <a href="{{ attraction.website }}" target="_blank">æŸ¥çœ‹å®˜ç¶²</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="contact-item">
                        <div class="contact-icon">ğŸ“</div>
                        <div class="contact-details">
                            <div class="contact-label">åœ°å€</div>
                            <div class="contact-value">{{ attraction.address }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³å´ï¼šè©•åˆ†çµ±è¨ˆå’ŒåŠ å…¥è¡Œç¨‹ -->
        <div class="action-section">
            <!-- æ™¯é»çµ±è¨ˆ -->
            <div class="stats-card">
                <h3 class="section-title">æ™¯é»çµ±è¨ˆ</h3>
                <div class="stats-grid">
                    <!-- ç§»é™¤è©•åˆ†ç›¸é—œçµ±è¨ˆï¼Œæ”¹ç‚ºé¡¯ç¤ºå…¶ä»–è³‡è¨Š -->
                    <div class="stat-item">
                        <div class="stat-label">æ™¯é»é¡å‹</div>
                        <div class="stat-value">{{ attraction.attraction_type.name }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ‰€åœ¨åœ°å€</div>
                        <div class="stat-value">{{ attraction.region.name }}</div>
                    </div>
                   
                </div>
            </div>

            <!-- åŠ å…¥è¡Œç¨‹å¡ç‰‡ -->
            <div class="add-to-trip-card">
                <h3 class="section-title">åŠ å…¥è¡Œç¨‹</h3>
                
                <!-- é¸æ“‡è¡Œç¨‹çš„ä¸‹æ‹‰é¸å–® -->
                <div class="trip-selector">
                    <label for="trip-select">é¸æ“‡è¡Œç¨‹ï¼š</label>
                    <select id="trip-select" class="trip-select">
                        <option value="">è«‹é¸æ“‡è¡Œç¨‹...</option>
                        {% for trip in user_trips_me %}
                            <option value="{{ trip.id }}">{{ trip.trip_name }}</option>
                        {% endfor %}
                    </select>
                    <button class="create-new-trip-btn" onclick="window.location.href='{% url 'travel:create_trip' %}'">
                        + å»ºç«‹æ–°è¡Œç¨‹
                    </button>
                </div>

                <!-- é¸æ“‡æ—¥æœŸ -->
                <div class="date-selector" id="date-selector" style="display: none;">
                    <label for="date-select">é¸æ“‡æ—¥æœŸï¼š</label>
                    <select id="date-select" class="date-select">
                        <option value="">è«‹å…ˆé¸æ“‡è¡Œç¨‹</option>
                    </select>
                </div>

                <!-- åŠ å…¥è¡Œç¨‹æŒ‰éˆ• -->
                <button class="add-to-trip-btn" 
                        data-attraction-id="{{ attraction.id }}" 
                        onclick="addToTrip(this)">
                    åŠ å…¥è¡Œç¨‹
                </button>

                <!-- ç”¨æˆ¶åå¥½è¨­å®š -->
                <div class="preference-note">
                    <label class="checkbox-container">
                        <input type="checkbox" id="remember-trip" checked>
                        <span class="checkmark"></span>
                        <span class="checkbox-text">è¨˜ä½æˆ‘çš„é¸æ“‡ï¼Œä¸‹æ¬¡è‡ªå‹•ä½¿ç”¨æ­¤è¡Œç¨‹</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.back-btn {
    background: #ff69b4;
    color:white;
    text-decoration: none;
    font-weight: 500;
    padding: 10px 20px;
    border: 2px solid #ff69b4;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.back-btn:hover {
    background: #747d85;
    color: white;
    border: 2px solid #747d85;
}

.action-buttons {
    display: flex;
    gap: 10px;
}

.favorite-btn, .share-btn {
    width: 44px;
    height: 44px;
    border: 2px solid #e0e0e0;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
}

.favorite-btn:hover {
    border-color: #ff69b4;
    color: #ff69b4;
}

.share-btn:hover {
    border-color: #ff69b4;
    color: #ff69b4;
}

/* åœ–ç‰‡è¼ªæ’­ */
.image-gallery {
    margin-bottom: 30px;
}

.main-image {
    position: relative;
    width: 100%;
    height: 400px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.image-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
}

/* æ™¯é»æ¨™é¡Œå€ */
.attraction-header {
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 2px solid #f0f0f0;
}

.attraction-title {
    font-size: 32px;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
}

.attraction-badges {
    display: flex;
    justify-content: center;
    gap: 10px;
}

.badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
}

.badge.primary {
    background: #ff69b4;
    color: white;
}

.badge.secondary {
    background: #f8f9fa;
    color: #666;
    border: 2px solid #e0e0e0;
}

/* å…§å®¹ç¶²æ ¼ */
.content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 25px;
}

/* è³‡è¨Šå¡ç‰‡ */
.info-card, .stats-card, .add-to-trip-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 25px;
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 20px;
    background: #ff69b4;
    border-radius: 2px;
}

.section-content p {
    line-height: 1.6;
    color: #666;
    margin: 0;
}

/* ç‰¹è‰²åˆ—è¡¨ */
.features-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
}

.feature-icon {
    color: #ff69b4;
    font-weight: bold;
    margin-top: 2px;
}

.feature-text {
    flex: 1;
    line-height: 1.5;
    color: #666;
}

/* è¯çµ¡è³‡è¨Š */
.contact-info {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.contact-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.contact-icon {
    font-size: 20px;
    width: 24px;
    text-align: center;
}

.contact-details {
    flex: 1;
}

.contact-label {
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
}

.contact-value {
    color: #666;
    line-height: 1.4;
}

.contact-value a {
    color: #ff69b4;
    text-decoration: none;
}

.contact-value a:hover {
    text-decoration: underline;
}

/* çµ±è¨ˆå€åŸŸ */
.stats-grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #f0f0f0;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    font-weight: 500;
    color: #666;
}

.stat-value {
    font-weight: 600;
    color: #333;
}

/* åŠ å…¥è¡Œç¨‹å€åŸŸ */
.trip-selector, .date-selector {
    margin-bottom: 20px;
}

.trip-selector label, .date-selector label {
    display: block;
    font-weight: 500;
    color: #333;
    margin-bottom: 8px;
}

.trip-select, .date-select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    background: white;
    margin-bottom: 10px;
}

.trip-select:focus, .date-select:focus {
    outline: none;
    border-color: #ff69b4;
}

.create-new-trip-btn {
    width: 100%;
    padding: 10px;
    background: #f8f9fa;
    border: 2px dashed #e0e0e0;
    border-radius: 8px;
    color: #666;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
}

.create-new-trip-btn:hover {
    border-color: #ff69b4;
    color: #ff69b4;
    background: #fef7f7;
}

.add-to-trip-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(#ff69b4);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 15px;
}

.add-to-trip-btn:hover:not(:disabled) {
    background: linear-gradient(#e55aa0);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);
}

.add-to-trip-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* åå¥½è¨­å®š */
.preference-note {
    border-top: 1px solid #f0f0f0;
    padding-top: 15px;
}

.checkbox-container {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 14px;
    color: #666;
}

.checkbox-container input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid #e0e0e0;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.checkbox-container input[type="checkbox"]:checked + .checkmark {
    background: #ff69b4;
    border-color: #ff69b4;
}

.checkbox-container input[type="checkbox"]:checked + .checkmark::after {
    content: 'âœ“';
    color: white;
    font-size: 12px;
    font-weight: bold;
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 768px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .attraction-title {
        font-size: 24px;
    }
    
    .main-image {
        height: 250px;
    }
    
    .detail-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }
}
</style>
{% csrf_token %}
<script>
// é é¢è¼‰å…¥æ™‚åŸ·è¡Œçš„å‡½æ•¸
document.addEventListener('DOMContentLoaded', function() {
    console.log('é é¢è¼‰å…¥å®Œæˆ');
    
    // æª¢æŸ¥æ˜¯å¦æœ‰è¨˜ä½çš„è¡Œç¨‹åå¥½
    const rememberedTrip = localStorage.getItem('preferred_trip_id');
    if (rememberedTrip) {
        const tripSelect = document.getElementById('trip-select');
        if (tripSelect) {
            tripSelect.value = rememberedTrip;
            loadTripDates(rememberedTrip);
        }
    }
    
    // ç¶å®šè¡Œç¨‹é¸æ“‡äº‹ä»¶
    const tripSelect = document.getElementById('trip-select');
    if (tripSelect) {
        tripSelect.addEventListener('change', function() {
            const tripId = this.value;
            console.log('é¸æ“‡çš„è¡Œç¨‹ID:', tripId);
            if (tripId) {
                loadTripDates(tripId);
            } else {
                hideDateSelector();
            }
        });
    }
});

// è¼‰å…¥è¡Œç¨‹æ—¥æœŸ
function loadTripDates(tripId) {
    if (!tripId) return;
    
    console.log('è¼‰å…¥è¡Œç¨‹æ—¥æœŸ:', tripId);
    fetch(`/get-trip-dates/${tripId}/`)
        .then(response => response.json())
        .then(data => {
            console.log('æ—¥æœŸè³‡æ–™:', data);
            if (data.success) {
                showDateSelector(data.dates);
            } else {
                console.error('è¼‰å…¥æ—¥æœŸå¤±æ•—:', data.message);
            }
        })
        .catch(error => {
            console.error('è¼‰å…¥æ—¥æœŸè«‹æ±‚å¤±æ•—:', error);
        });
}

// é¡¯ç¤ºæ—¥æœŸé¸æ“‡å™¨
function showDateSelector(dates) {
    console.log('é¡¯ç¤ºæ—¥æœŸé¸æ“‡å™¨ï¼Œæ—¥æœŸæ•¸é‡:', dates.length);
    const dateSelector = document.getElementById('date-selector');
    const dateSelect = document.getElementById('date-select');
    
    if (!dateSelector || !dateSelect) {
        console.error('æ‰¾ä¸åˆ°æ—¥æœŸé¸æ“‡å™¨å…ƒç´ ');
        return;
    }
    
    // æ¸…ç©ºé¸é …
    dateSelect.innerHTML = '<option value="">è«‹é¸æ“‡æ—¥æœŸ...</option>';
    
    // æ·»åŠ æ—¥æœŸé¸é …
    dates.forEach(date => {
        const option = document.createElement('option');
        option.value = date.value;
        option.textContent = date.label;
        dateSelect.appendChild(option);
    });
    
    dateSelector.style.display = 'block';
    
    // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨
    const newDateSelect = dateSelect.cloneNode(true);
    dateSelect.parentNode.replaceChild(newDateSelect, dateSelect);
    
    // ç¶å®šæ—¥æœŸé¸æ“‡äº‹ä»¶
    newDateSelect.addEventListener('change', function() {
        const addBtn = document.querySelector('.add-to-trip-btn');
        if (addBtn) {
            addBtn.disabled = !this.value;
            console.log('æŒ‰éˆ•ç‹€æ…‹:', addBtn.disabled ? 'ç¦ç”¨' : 'å•Ÿç”¨');
        }
    });
}

// éš±è—æ—¥æœŸé¸æ“‡å™¨
function hideDateSelector() {
    console.log('éš±è—æ—¥æœŸé¸æ“‡å™¨');
    const dateSelector = document.getElementById('date-selector');
    const addBtn = document.querySelector('.add-to-trip-btn');
    
    if (dateSelector) {
        dateSelector.style.display = 'none';
    }
    if (addBtn) {
        addBtn.disabled = true;
    }
}

// åŠ å…¥è¡Œç¨‹å‡½æ•¸
function addToTrip(button) {
    console.log('=== addToTrip é–‹å§‹ ===');
    
    // ç²å–å¿…è¦çš„æ•¸å€¼
    const tripId = document.getElementById('trip-select').value;
    const selectedDate = document.getElementById('date-select').value;
    const rememberChoice = document.getElementById('remember-trip').checked;
    
    console.log('tripId:', tripId);
    console.log('selectedDate:', selectedDate);
    console.log('rememberChoice:', rememberChoice);
    
    if (!tripId || !selectedDate) {
        alert('è«‹é¸æ“‡è¡Œç¨‹å’Œæ—¥æœŸ');
        return;
    }
    
    // å¾æŒ‰éˆ•ç²å–æ™¯é» ID
    const attractionId = button.getAttribute('data-attraction-id');
    if (!attractionId) {
        alert('æ™¯é» ID æœªæ‰¾åˆ°ï¼Œè«‹é‡æ–°è¼‰å…¥é é¢');
        return;
    }
    
    console.log('attractionId:', attractionId);
    
    // ç¦ç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
    button.disabled = true;
    const originalText = button.textContent;
    button.textContent = 'åŠ å…¥ä¸­...';
    
    // ç²å– CSRF token
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
    if (!csrfToken) {
        alert('CSRF token æœªæ‰¾åˆ°ï¼Œè«‹é‡æ–°è¼‰å…¥é é¢');
        button.disabled = false;
        button.textContent = originalText;
        return;
    }
    
    // ç™¼é€è«‹æ±‚
    fetch('/add-attraction-to-trip/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken.value,
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            attraction_id: attractionId,
            trip_id: tripId,
            selected_date: selectedDate,
            remember_choice: rememberChoice
        })
    })
    .then(response => {
        console.log('éŸ¿æ‡‰ç‹€æ…‹:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('ä¼ºæœå™¨éŸ¿æ‡‰:', data);
        
        if (data.success) {
            // ä¿å­˜ç”¨æˆ¶åå¥½
            if (rememberChoice) {
                localStorage.setItem('preferred_trip_id', tripId);
            }
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            if (typeof showMessage === 'function') {
                showMessage(data.message, 'success');
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            button.style.background = '#28a745';
            button.textContent = 'å·²åŠ å…¥';
            
            // 1ç§’å¾Œè‡ªå‹•è·³è½‰åˆ°è¡Œç¨‹ç·¨è¼¯é é¢
            setTimeout(() => {
                console.log('æº–å‚™è·³è½‰åˆ°:', `/trip/edit/${tripId}/`);
                window.location.href = `/trip/edit/${tripId}/`;
            }, 1000);
            
        } else {
            alert(data.message || 'åŠ å…¥è¡Œç¨‹å¤±æ•—');
            button.disabled = false;
            button.textContent = originalText;
        }
    })
    .catch(error => {
        console.error('åŠ å…¥è¡Œç¨‹è«‹æ±‚å¤±æ•—:', error);
        alert('åŠ å…¥è¡Œç¨‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        button.disabled = false;
        button.textContent = originalText;
    });
}

// åˆ‡æ›æ”¶è—ç‹€æ…‹
function toggleFavorite(attractionId) {
    const favoriteBtn = document.querySelector('.favorite-btn');
    const heartIcon = favoriteBtn.querySelector('.heart-icon');
    
    fetch('/toggle-favorite/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            attraction_id: attractionId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.is_favorite) {
                heartIcon.textContent = 'â™¥';
                heartIcon.style.color = '#ff69b4';
                showMessage('å·²åŠ å…¥æ”¶è—', 'success');
            } else {
                heartIcon.textContent = 'â™¡';
                heartIcon.style.color = '';
                showMessage('å·²å–æ¶ˆæ”¶è—', 'info');
            }
        }
    })
    .catch(error => {
        console.error('æ”¶è—æ“ä½œå¤±æ•—:', error);
    });
}

// åˆ†äº«æ™¯é»
function shareAttraction() {
    if (navigator.share) {
        navigator.share({
            title: '{{ attraction.name }}',
            text: '{{ attraction.description|truncatechars:100 }}',
            url: window.location.href,
        });
    } else {
        // å‚™ç”¨æ–¹æ¡ˆï¼šè¤‡è£½é€£çµåˆ°å‰ªè²¼æ¿
        navigator.clipboard.writeText(window.location.href).then(() => {
            showMessage('é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼æ¿', 'success');
        });
    }
}

// é¡¯ç¤ºè¨Šæ¯
function showMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.className = `alert alert-${type}`;
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
    `;
    
    switch(type) {
        case 'success':
            messageDiv.style.background = '#28a745';
            break;
        case 'error':
            messageDiv.style.background = '#dc3545';
            break;
        default:
            messageDiv.style.background = '#17a2b8';
    }
    
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (messageDiv.parentElement) {
                messageDiv.remove();
            }
        }, 300);
    }, 3000);
}

// CSS å‹•ç•«
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}

